"use strict";(self.webpackChunk_switchboard_xyz_v2_docs=self.webpackChunk_switchboard_xyz_v2_docs||[]).push([[6554],{5318:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return d}});var r=a(7378);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),i=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=i(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),g=i(a),d=n,m=g["".concat(s,".").concat(d)]||g[d]||p[d]||o;return a?r.createElement(m,l(l({ref:t},u),{},{components:a})):r.createElement(m,l({ref:t},u))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=g;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:n,l[1]=c;for(var i=2;i<o;i++)l[i]=a[i];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}g.displayName="MDXCreateElement"},3243:function(e,t,a){a.r(t),a.d(t,{contentTitle:function(){return s},default:function(){return g},frontMatter:function(){return c},metadata:function(){return i},toc:function(){return u}});var r=a(5773),n=a(808),o=(a(7378),a(5318)),l=["components"],c={sidebar_position:25,slug:"/oracle/gcp/manual-setup"},s="Manual Setup",i={unversionedId:"oracle/gcp/manual",id:"oracle/gcp/manual",title:"Manual Setup",description:"Login",source:"@site/docs/oracle/gcp/manual.mdx",sourceDirName:"oracle/gcp",slug:"/oracle/gcp/manual-setup",permalink:"/oracle/gcp/manual-setup",tags:[],version:"current",sidebarPosition:25,frontMatter:{sidebar_position:25,slug:"/oracle/gcp/manual-setup"},sidebar:"tutorialSidebar",previous:{title:"Automated Setup",permalink:"/oracle/gcp/automated-setup"},next:{title:"Grafana",permalink:"/oracle/gcp/grafana"}},u=[{value:"Login",id:"login",children:[],level:2},{value:"Project",id:"project",children:[],level:2},{value:"gcloud Config",id:"gcloud-config",children:[],level:2},{value:"Billing",id:"billing",children:[],level:2},{value:"Services",id:"services",children:[],level:2},{value:"External IP",id:"external-ip",children:[],level:2},{value:"Service Account",id:"service-account",children:[],level:2},{value:"Oracle Payer Secret",id:"oracle-payer-secret",children:[],level:2},{value:"Storage Bucket",id:"storage-bucket",children:[],level:2},{value:"Kubernetes Cluster",id:"kubernetes-cluster",children:[],level:2},{value:"Wrapping Up",id:"wrapping-up",children:[],level:2}],p={toc:u};function g(e){var t=e.components,a=(0,n.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"manual-setup"},"Manual Setup"),(0,o.kt)("h2",{id:"login"},"Login"),(0,o.kt)("p",null,"Login to your google cloud account:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud auth login\n")),(0,o.kt)("h2",{id:"project"},"Project"),(0,o.kt)("p",null,"Create a new project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'gcloud projects create switchboard-oracle-cluster --name="Switchboard Oracle"\n')),(0,o.kt)("p",null,"Set it as your default project"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud config set project switchboard-oracle-cluster\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/sdk/gcloud/reference/projects/create"},"Google - gcloud projects create")),(0,o.kt)("h2",{id:"gcloud-config"},"gcloud Config"),(0,o.kt)("p",null,"Set the default zone using ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/compute/docs/regions-zones#available"},"list of regions and zones")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud config set compute/zone us-west1-a # replace with your closest region\n")),(0,o.kt)("p",null,"Set the default region using ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/compute/docs/regions-zones#available"},"list of regions and zones")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud config set compute/region us-west1 # replace with your closest region\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/kubernetes-engine/docs/quickstart#autopilot"},"Google - Set default settings for the gcloud tool")),(0,o.kt)("h2",{id:"billing"},"Billing"),(0,o.kt)("p",null,"You will need to enable billing for the project before enabling any services:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/billing/enable?project=switchboard-oracle-cluster"},"https://console.cloud.google.com/billing/enable?project=switchboard-oracle-cluster"))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://support.google.com/googleapi/answer/6158867?hl=en"},"Google - APIs and billing")),(0,o.kt)("h2",{id:"services"},"Services"),(0,o.kt)("p",null,"Enable the relevant services:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud services enable compute.googleapis.com\ngcloud services enable container.googleapis.com\ngcloud services enable iamcredentials.googleapis.com\ngcloud services enable secretmanager.googleapis.com\n")),(0,o.kt)("h2",{id:"external-ip"},"External IP"),(0,o.kt)("p",null,"You will need to reserve a static IP address for your grafana instance"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud compute addresses create load-balancer --project=switchboard-oracle-cluster\ngcloud compute addresses list\n# NAME           ADDRESS/RANGE\n# load-balancer  123.123.123.123 ($LOADBALANCER_IP)\n")),(0,o.kt)("p",null,"This will be your ",(0,o.kt)("inlineCode",{parentName:"p"},"$EXTERNAL_IP")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address#reserve_new_static"},"Google - Reserve a new static external IP address")),(0,o.kt)("h2",{id:"service-account"},"Service Account"),(0,o.kt)("p",null,"You will need to create a service account to access our resources."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'gcloud iam service-accounts create svc-account --display-name="Oracle Service Account"\ngcloud iam service-accounts list\n')),(0,o.kt)("p",null,"Now save it to our filesystem"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud iam service-accounts keys create secrets/svc-account.json  --iam-account=svc-account@switchboard-oracle-cluster.iam.gserviceaccount.com\n")),(0,o.kt)("p",null,"Now convert the json file to a base64 string to store in ",(0,o.kt)("inlineCode",{parentName:"p"},"$SERVICE_ACCOUNT_BASE64")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"base64 secrets/svc-account.json\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/iam/docs/creating-managing-service-account-keys"},"Google - Creating service account keys")),(0,o.kt)("h2",{id:"oracle-payer-secret"},"Oracle Payer Secret"),(0,o.kt)("p",null,"You will need to store your solana keypair in Google Secret Manager for enhanced security. If you are using another keypair replace ",(0,o.kt)("inlineCode",{parentName:"p"},"--data-file")," with your relevant path."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'gcloud secrets create oracle-payer-secret --replication-policy="automatic"  --data-file=secrets/authority-keypair.json\n')),(0,o.kt)("p",null,"You can view your ",(0,o.kt)("inlineCode",{parentName:"p"},"$GOOGLE_PAYER_SECRET_PATH")," in the ",(0,o.kt)("a",{parentName:"p",href:"https://console.cloud.google.com/security/secret-manager/secret/oracle-payer-secret/versions&project=switchboard-oracle-cluster"},"GCP console")," or by running the command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"echo \"$(gcloud secrets list --uri --filter=oracle-payer-secret | \\\ncut -c41- | tr -d '\\n')/versions/latest\"\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/secret-manager/docs/creating-and-accessing-secrets"},"Google - Creating a secret")),(0,o.kt)("h2",{id:"storage-bucket"},"Storage Bucket"),(0,o.kt)("p",null,"You can create a GCP storage bucket to store API keys. The following command will create a new storage bucket and give your service account permissions to read from it. You will need to use a unique name as storage bucket names are global to the entire GCP platform."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gsutil mb -p switchboard-oracle-cluster -l us-west1 gs://switchboard-oracle-cluster-bucket\ngsutil iam ch serviceAccount:svc-account@switchboard-oracle-cluster.iam.gserviceaccount.com:legacyBucketReader gs://switchboard-oracle-cluster-bucket\ngsutil ls\n# gs://switchboard-oracle-cluster-bucket/\n")),(0,o.kt)("p",null,"You can view your ",(0,o.kt)("inlineCode",{parentName:"p"},"$GCP_CONFIG_BUCKET")," by running the command"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"echo \"$(gsutil ls | grep 'switchboard-oracle-cluster-bucket' | \\\nsed -e 's/.*gs:\\/\\/\\(.*\\)\\/.*/\\1/' ):configs.json\"\n# switchboard-oracle-cluster-bucket:configs.json\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/storage/docs/creating-buckets#storage-create-bucket-gsutil"},"Google - Create storage buckets")),(0,o.kt)("h2",{id:"kubernetes-cluster"},"Kubernetes Cluster"),(0,o.kt)("p",null,"Finally you will need to create a new kubernetes cluster"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud container clusters create-auto switchboard-cluster \\\n--service-account=svc-account@switchboard-oracle-cluster.iam.gserviceaccount.com \\\n--region us-west1\n")),(0,o.kt)("p",null,"then connect to it and store your credentials in your gCloud config"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"gcloud container clusters get-credentials switchboard-cluster \\\n--project switchboard-oracle-cluster \\\n--region us-west1\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Remember to update the region to the same region you used for your static IP."))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/kubernetes-engine/docs/quickstart#autopilot"},"Google - Create a GKE cluster")),(0,o.kt)("h2",{id:"wrapping-up"},"Wrapping Up"),(0,o.kt)("p",null,"You should now have an ",(0,o.kt)("inlineCode",{parentName:"p"},"PROJECTNAME.env")," file containing"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"EXTERNAL_IP"),(0,o.kt)("li",{parentName:"ul"},"GOOGLE_PAYER_SECRET_PATH"),(0,o.kt)("li",{parentName:"ul"},"GCP_CONFIG_BUCKET"),(0,o.kt)("li",{parentName:"ul"},"SERVICE_ACCOUNT_BASE64")),(0,o.kt)("p",null,"You will need to manually add:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"CLUSTER"),(0,o.kt)("li",{parentName:"ul"},"RPC_URL"),(0,o.kt)("li",{parentName:"ul"},"BACKUP_MAINNET_RPC"),(0,o.kt)("li",{parentName:"ul"},"ORACLE_KEY"),(0,o.kt)("li",{parentName:"ul"},"GRAFANA_HOSTNAME"),(0,o.kt)("li",{parentName:"ul"},"GRAFANA_PASSWORD"),(0,o.kt)("li",{parentName:"ul"},"GRAFANA_TLS_CRT"),(0,o.kt)("li",{parentName:"ul"},"GRAFANA_TLS_KEY")))}g.isMDXComponent=!0}}]);